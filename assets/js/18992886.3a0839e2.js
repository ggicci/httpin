"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[464],{3765:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>g,frontMatter:()=>l,metadata:()=>u,toc:()=>h});var i=n(5893),r=n(1151),s=n(2332),a=n(4148),d=n(5757);const l={sidebar_position:98},c="default",u={id:"directives/default",title:"default",description:"Introduced in v0.8.0.",source:"@site/docs/directives/default.mdx",sourceDirName:"directives",slug:"/directives/default",permalink:"/httpin/directives/default",draft:!1,unlisted:!1,editUrl:"https://github.com/ggicci/httpin/edit/documentation/docs/docs/directives/default.mdx",tags:[],version:"current",sidebarPosition:98,frontMatter:{sidebar_position:98},sidebar:"docsSidebar",previous:{title:"nonzero",permalink:"/httpin/directives/nonzero"},next:{title:"coder",permalink:"/httpin/directives/coder"}},o={},h=[{value:"Signature",id:"signature",level:2},{value:"Decoding",id:"decoding",level:2},{value:"Usage",id:"usage",level:3},{value:"Runable Example",id:"runable-example",level:3},{value:"Encoding",id:"encoding",level:2},{value:"Runable Example",id:"runable-example-1",level:3}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"default",children:"default"}),"\n",(0,i.jsx)(t.p,{children:"Introduced in v0.8.0."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"default"})," is a ",(0,i.jsx)(t.a,{href:"/advanced/concepts#directive-executor",children:"directive executor"})," who\npopulates ",(0,i.jsx)(t.strong,{children:"unset fields"})," to their default values while decoding, and populates\n",(0,i.jsx)(t.strong,{children:"zero fields"})," to their default values while encoding."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"unset fields"}),": fields that have not been set by former directives."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"zero fields"}),": values are zero values, such as ",(0,i.jsx)(t.code,{children:"0"}),", ",(0,i.jsx)(t.code,{children:'""'}),", ",(0,i.jsx)(t.code,{children:"false"}),", ",(0,i.jsx)(t.code,{children:"nil"}),",\n",(0,i.jsx)(t.code,{children:"[]"}),", ",(0,i.jsx)(t.code,{children:"map[]"}),", ",(0,i.jsx)(t.code,{children:"struct{}"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"signature",children:"Signature"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'Name: "default"\nArgs: VAL1 [,VAL2 [,VAL3, ...]]\n'})}),"\n",(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsx)(t.p,{children:"For an array type of value, you can use comma to separate the items in the array.\nSo the presence of comma in an array item can lead to unexpected behavior."})}),"\n",(0,i.jsx)(t.h2,{id:"decoding",children:"Decoding"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"default"})," will examine if the field has already been set by former directives. If not, it will set the field to the given value."]}),"\n",(0,i.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'type ListTasksQuery struct {\n\tPage      int      `in:"query=page;default=1"`\n\tPerPage   int      `in:"query=per_page;default=20"`\n\tStateList []string `in:"query=state;default=pending,running"`\n}\n'})}),"\n",(0,i.jsx)(a.Z,{inputTitle:d.Z.inputOutput.inputTitle,outputTitle:d.Z.inputOutput.outputTitle,rows:d.Z.inputOutput.rows}),"\n",(0,i.jsx)(t.h3,{id:"runable-example",children:"Runable Example"}),"\n",(0,i.jsx)(s.Z,{children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"net/http"\n\t"net/http/httptest"\n\n\t"github.com/ggicci/httpin"\n\t"github.com/go-chi/chi/v5"\n)\n\ntype ListTasksQuery struct {\n\tPage      int      `in:"query=page;default=1"`\n\tPerPage   int      `in:"query=per_page;default=20"`\n\tStateList []string `in:"query=state;default=pending,running"`\n}\n\nfunc ListTasks(rw http.ResponseWriter, r *http.Request) {\n\tinput := r.Context().Value(httpin.Input).(*ListTasksQuery)\n\tfmt.Printf("input: %#v\\n", input)\n}\n\nfunc main() {\n\trouter := chi.NewRouter()\n\trouter.With(\n\t\thttpin.NewInput(ListTasksQuery{}),\n\t).Get("/tasks", ListTasks)\n\n\tr, _ := http.NewRequest("GET", "/tasks?page=0", nil)\n\n\trw := httptest.NewRecorder()\n\trouter.ServeHTTP(rw, r)\n\n}\n'})})}),"\n",(0,i.jsx)(t.p,{children:"Output:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:'input: &main.ListTasksQuery{Page:0, PerPage:20, StateList:[]string{"pending", "running"}}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"encoding",children:"Encoding"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"default"})," will examine if the field is a zero value. If so, it will set the field to the given value."]}),"\n",(0,i.jsxs)(t.admonition,{type:"note",children:[(0,i.jsxs)(t.p,{children:["Since ",(0,i.jsx)(t.strong,{children:"httpin"})," runs the directives in the order of their appearance in the struct,\nyou should ",(0,i.jsx)(t.strong,{children:"always"})," define the order of the directives based on decoding\nrequirements, ",(0,i.jsx)(t.strong,{children:"default"})," should be placed after directives like\n",(0,i.jsx)(t.a,{href:"/directives/query",children:"query"})," and ",(0,i.jsx)(t.a,{href:"/directives/path",children:"path"})," that set the field\nvalues."]}),(0,i.jsxs)(t.p,{children:["In order to make it works for encoding as well, ",(0,i.jsx)(t.strong,{children:"httpin"})," will reorder the\ndirectives internally for encoding. The final order of directives will be:"]}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/directives/required",children:"required"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/directives/default",children:"default"})}),"\n",(0,i.jsx)(t.li,{children:"other directives"}),"\n"]}),(0,i.jsx)(t.p,{children:"For example, the above struct will be reordered to:"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'type ListTasksQuery struct {\n\tPage      int      `in:"default=1;query=page"`\n\tPerPage   int      `in:"default=20;query=per_page"`\n}\n'})})]}),"\n",(0,i.jsx)(t.h3,{id:"runable-example-1",children:"Runable Example"}),"\n",(0,i.jsx)(s.Z,{children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"net/http/httputil"\n\n\t"github.com/ggicci/httpin"\n)\n\ntype ListTasksQuery struct {\n\tPage      int      `in:"query=page;default=1"`\n\tPerPage   int      `in:"query=per_page;default=20"`\n\tStateList []string `in:"query=state;default=pending,running"`\n}\n\nfunc main() {\n\tinput := &ListTasksQuery{Page: 3}\n\tr, _ := httpin.NewRequest("GET", "/tasks", input)\n\tdata, _ := httputil.DumpRequest(r, true)\n\tfmt.Printf("%s\\n", data)\n}\n'})})}),"\n",(0,i.jsx)(t.p,{children:"Output:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"GET /tasks?page=3&per_page=20&state=pending&state=running HTTP/1.1\n"})})]})}function g(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},5757:(e,t,n)=>{n.d(t,{Z:()=>i});const i={inputOutput:{inputTitle:"Request",outputTitle:"ListTasksQuery",rows:[{input:"\n  GET /tasks?page=4&perPage=10&state=failed&state=succeeded\n  ",output:'\n  {\n      Page:      4,\n      PerPage:   10,\n      StateList: []string{"failed", "succeeded"},\n  }'},{input:"\n  GET /tasks\n  ",output:'\n  {\n            Page:      1,\n            PerPage:   20,\n            StateList: []string{"pending", "running"},\n  }'}]}}},4148:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(6112),r=(n(7294),n(5893));const s=e=>(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:e.inputTitle||"Input"}),(0,r.jsx)("th",{children:e.outputTitle||"Output"})]})}),(0,r.jsx)("tbody",{children:e.rows.map(((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)(i.Z,{children:e.input.trim()})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.Z,{className:"language-go",children:e.output.trim()})})]},t)))})]})}}]);
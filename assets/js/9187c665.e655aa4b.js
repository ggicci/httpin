"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[870],{2803:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>c,toc:()=>h});var r=n(5893),i=n(1151),o=n(2332),s=n(4148);const d={inputOutput:{inputTitle:"Request (Mixed, Body + URL query)",outputTitle:"Profile",rows:[{input:"\nGET /users?role=backend&hireable=true\n",output:'\n{\n  Role: "backend",\n  Hireable: true,\n}\n\n// works just like query directive\n'},{input:"\nPOST /users HTTP/1.1\nHost: foo.example\nContent-Type: application/x-www-form-urlencoded\n\nrole=frontend&hireable=false\n",output:'\n{\n  Role: "frontend",\n  Hireable: false,\n}\n'},{input:"\nPOST /users?hireable=true HTTP/1.1\nHost: foo.example\nContent-Type: application/x-www-form-urlencoded\n\nrole=frontend&hireable=false\n",output:'\n{\n  Role: "frontend",\n  Hireable: false,\n}\n\n// Hireable in the body overrides the URL query.\n'},{input:"\nPOST /users?hireable=true HTTP/1.1\nHost: foo.example\nContent-Type: application/x-www-form-urlencoded\n\nrole=frontend\n",output:'\n{\n  Role: "frontend",\n  Hireable: true,\n}\n\n// Hireable is from URL query.\n'}]}},a={sidebar_position:3},l="form",c={id:"directives/form",title:"form",description:"form is a directive executor who decodes/encodes a field from/to HTTP form data, i.e. http.Request.Form.",source:"@site/docs/directives/form.mdx",sourceDirName:"directives",slug:"/directives/form",permalink:"/httpin/directives/form",draft:!1,unlisted:!1,editUrl:"https://github.com/ggicci/httpin/edit/documentation/docs/docs/directives/form.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"header",permalink:"/httpin/directives/header"},next:{title:"body",permalink:"/httpin/directives/body"}},u={},h=[{value:"Signature",id:"signature",level:2},{value:"Decoding",id:"decoding",level:2},{value:"Usage",id:"usage",level:3},{value:"Runable Example",id:"runable-example",level:3},{value:"Encoding",id:"encoding",level:2},{value:"Runable Example",id:"runable-example-1",level:3}];function p(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"form",children:"form"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"form"})," is a ",(0,r.jsx)(t.a,{href:"/advanced/concepts#directive-executor",children:"directive executor"})," who decodes/encodes a field from/to HTTP form data, i.e. ",(0,r.jsx)(t.a,{href:"https://pkg.go.dev/net/http#Request",children:(0,r.jsx)(t.code,{children:"http.Request.Form"})}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"signature",children:"Signature"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'Name: "form"\nArgs: KEY1 [,KEY2 [,KEY3, ...]]\n'})}),"\n",(0,r.jsx)(t.h2,{id:"decoding",children:"Decoding"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"form"})," will examine values of the keys one by one (KEY1 -> KEY2 -> ...) from the form data, the ",(0,r.jsx)(t.strong,{children:"first non-empty"})," value will be used to set the corresponding field of the input struct."]}),"\n",(0,r.jsxs)(t.admonition,{type:"caution",children:[(0,r.jsxs)(t.p,{children:["In most cases, the ",(0,r.jsx)(t.code,{children:"form"})," directive just works like ",(0,r.jsx)(t.a,{href:"/directives/query",children:(0,r.jsx)(t.code,{children:"query"})}),". Because it also visits data from the URL querystring.\nBut if the form data sent by the client was of ",(0,r.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST",children:(0,r.jsx)(t.code,{children:"application/x-www-form-urlencoded"})})," content type, ",(0,r.jsx)(t.code,{children:"form"})," will visit the form data first,\nand then visit the URL querystring."]}),(0,r.jsxs)(t.p,{children:["For more details, please refer to ",(0,r.jsx)(t.a,{href:"https://github.com/ggicci/httpin/pull/6#issuecomment-939273364",children:"GH-5 add a query directive to pull values from querystring params #6"})," and the following quotes."]})]}),"\n",(0,r.jsx)(t.p,{children:"From the Go documentation:"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"Form contains the parsed form data, including both the URL field's query parameters and the PATCH, POST, or PUT form data.\nThis field is only available after ParseForm is called."}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["And for ",(0,r.jsx)(t.a,{href:"https://pkg.go.dev/net/http#Request.ParseForm",children:(0,r.jsx)(t.code,{children:"http.Request.ParseForm"})}),", it is:"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"ParseForm"})," populates ",(0,r.jsx)(t.code,{children:"r.Form"})," and ",(0,r.jsx)(t.code,{children:"r.PostForm"}),".\nFor all requests, ",(0,r.jsx)(t.code,{children:"ParseForm"})," parses the raw query from the URL and updates ",(0,r.jsx)(t.code,{children:"r.Form"}),".\nFor POST, PUT, and PATCH requests, it also reads the request body, parses it as a form and puts the results into both ",(0,r.jsx)(t.code,{children:"r.PostForm"})," and ",(0,r.jsx)(t.code,{children:"r.Form"}),".\nRequest body parameters take precedence over URL query string values in ",(0,r.jsx)(t.code,{children:"r.Form"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'type Profile struct {\n\tRole     string `in:"form=role"`\n\tHireable bool   `in:"form=hireable"`\n}\n'})}),"\n",(0,r.jsx)(s.Z,{inputTitle:d.inputOutput.inputTitle,outputTitle:d.inputOutput.outputTitle,rows:d.inputOutput.rows}),"\n",(0,r.jsx)(t.h3,{id:"runable-example",children:"Runable Example"}),"\n",(0,r.jsx)(o.Z,{children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"io"\n\t"net/http"\n\t"net/http/httptest"\n\t"net/url"\n\t"strings"\n\n\t"github.com/ggicci/httpin"\n\t"github.com/go-chi/chi/v5"\n)\n\ntype UpdateAccountInput struct {\n\tAccessToken string `in:"form=access_token"`\n\tBio         string `in:"form=bio"`\n}\n\nfunc UpdateAccount(rw http.ResponseWriter, r *http.Request) {\n\tinput := r.Context().Value(httpin.Input).(*UpdateAccountInput)\n\tfmt.Printf("input: %#v\\n", input)\n}\n\nfunc main() {\n\trouter := chi.NewRouter()\n\trouter.With(\n\t\thttpin.NewInput(UpdateAccountInput{}),\n\t).Patch("/me", UpdateAccount)\n\n\t// NOTE: form directive also visits querystring\n\tr, _ := http.NewRequest("PATCH", "/me?access_token=rainbow", nil)\n\tr.Header.Set("Content-Type", "application/x-www-form-urlencoded")\n\tform := make(url.Values)\n\tform.Add("bio", "\u3042\u308a\u304c\u3069\u3046")\n\tr.Body = io.NopCloser(strings.NewReader(form.Encode()))\n\n\trw := httptest.NewRecorder()\n\trouter.ServeHTTP(rw, r)\n}\n'})})}),"\n",(0,r.jsx)(t.p,{children:"Output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'input: &main.UpdateAccountInput{AccessToken:"rainbow", Bio:"\u3042\u308a\u304c\u3069\u3046"}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"encoding",children:"Encoding"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"form"})," will encode the field value to the form data with the key specified in the directive argument, the first key will be used, i.e. ",(0,r.jsx)(t.code,{children:"KEY1"}),", results in ",(0,r.jsx)(t.code,{children:"http.Request.Form[KEY1] = VALUE"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"runable-example-1",children:"Runable Example"}),"\n",(0,r.jsx)(o.Z,{children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"net/http/httputil"\n\n\t"github.com/ggicci/httpin"\n)\n\ntype Questionare struct {\n\tName     string  `in:"form=name;nonzero"`\n\tGender   int     `in:"form=gender"`\n\tPosition string  `in:"form=position"`\n\tHeight   float32 `in:"form=height"`\n\tWeight   float32 `in:"form=weight"`\n}\n\nfunc main() {\n\tpayload := &Questionare{\n\t\tName:     "Ggicci",\n\t\tGender:   0,\n\t\tPosition: "Stand up",\n\t\tHeight:   182.3,\n\t\tWeight:   73.5,\n\t}\n\tr, _ := httpin.NewRequest("POST", "/forms/weight-and-height", payload)\n\tdata, _ := httputil.DumpRequest(r, true)\n\tfmt.Printf("%s\\n", data)\n}\n'})})}),"\n",(0,r.jsx)(t.p,{children:"Output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"POST /forms/weight-and-height HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\n\ngender=0&height=182.3&name=Ggicci&position=Stand+up&weight=73.5\n"})})]})}function m(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},4148:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(6112),i=(n(7294),n(5893));const o=e=>(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:e.inputTitle||"Input"}),(0,i.jsx)("th",{children:e.outputTitle||"Output"})]})}),(0,i.jsx)("tbody",{children:e.rows.map(((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(r.Z,{children:e.input.trim()})}),(0,i.jsx)("td",{children:(0,i.jsx)(r.Z,{className:"language-go",children:e.output.trim()})})]},t)))})]})}}]);
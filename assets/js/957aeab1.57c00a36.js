"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[363],{748:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>l,toc:()=>u});var i=t(5893),r=t(1151),s=t(2332),a=t(4148);const o={inputOutput:{inputTitle:"Request (Header)",outputTitle:"TokenInput",rows:[{input:"\nGET /users HTTP/1.1\n\nHost: foo.example\nX-API-Token: abc\n",output:'{ Token: "abc" }'},{input:"\nGET /users HTTP/1.1\n\nHost: foo.example\nx-api-token: abc\n",output:'{ Token: "abc" }'},{input:"\nGET /users HTTP/1.1\n\nHost: foo.example\nAuthorization: good\n",output:'{ Token: "good" }'},{input:"\nGET /users HTTP/1.1\n\nHost: foo.example\nX-Api-Token: apple\nAuthorization: banana\n",output:'\n{ Token: "apple" }\n\n// Check order: X-Api-Token -> Authorization\n'}]}},d={sidebar_position:2},c="header",l={id:"directives/header",title:"header",description:"header is a directive executor who decodes/encodes a field from/to HTTP headers, i.e. http.Request.Header.",source:"@site/docs/directives/header.mdx",sourceDirName:"directives",slug:"/directives/header",permalink:"/httpin/directives/header",draft:!1,unlisted:!1,editUrl:"https://github.com/ggicci/httpin/edit/documentation/docs/docs/directives/header.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"query",permalink:"/httpin/directives/query"},next:{title:"form",permalink:"/httpin/directives/form"}},p={},u=[{value:"Signature",id:"signature",level:2},{value:"Decoding",id:"decoding",level:2},{value:"Usage",id:"usage",level:3},{value:"Runable Example",id:"runable-example",level:3},{value:"Encoding",id:"encoding",level:2},{value:"Runable Example",id:"runable-example-1",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"header",children:"header"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"header"})," is a ",(0,i.jsx)(n.a,{href:"/advanced/concepts#directive-executor",children:"directive executor"})," who decodes/encodes a field from/to HTTP headers, i.e. ",(0,i.jsx)(n.a,{href:"https://pkg.go.dev/net/http#Header",children:(0,i.jsx)(n.code,{children:"http.Request.Header"})}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"signature",children:"Signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Name: "header"\nArgs: KEY1 [,KEY2 [,KEY3, ...]]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"decoding",children:"Decoding"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"header"})," will examine values of the keys one by one (KEY1 -> KEY2 -> ...) from the HTTP headers, the ",(0,i.jsx)(n.strong,{children:"first non-empty"})," value will be used to set the corresponding field of the input struct."]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["The keys will be normalized, see ",(0,i.jsx)(n.a,{href:"https://pkg.go.dev/net/http#CanonicalHeaderKey",children:(0,i.jsx)(n.code,{children:"CanonicalHeaderKey"})}),", e.g. the header key of ",(0,i.jsx)(n.code,{children:"Content-Type"})," and ",(0,i.jsx)(n.code,{children:"content-type"})," are the same, which works like case-insensitive."]})}),"\n",(0,i.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type TokenInput struct {\n\tToken string `in:"header=x-api-token,Authorization"`\n}\n'})}),"\n",(0,i.jsx)(a.Z,{inputTitle:o.inputOutput.inputTitle,outputTitle:o.inputOutput.outputTitle,rows:o.inputOutput.rows}),"\n",(0,i.jsx)(n.h3,{id:"runable-example",children:"Runable Example"}),"\n",(0,i.jsx)(s.Z,{children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"io"\n\t"net/http"\n\t"net/http/httptest"\n\n\t"github.com/ggicci/httpin"\n\t"github.com/go-chi/chi/v5"\n)\n\ntype UpdateAccountInput struct {\n\tAccessToken   string `in:"header=x-myapp-access-token"`\n\tClientVersion int    `in:"header=x-myapp-client-version"`\n}\n\nfunc UpdateAccount(rw http.ResponseWriter, r *http.Request) {\n\tinput := r.Context().Value(httpin.Input).(*UpdateAccountInput)\n\tfmt.Printf("input: %#v\\n", input)\n}\n\nfunc main() {\n\trouter := chi.NewRouter()\n\trouter.With(\n\t\thttpin.NewInput(UpdateAccountInput{}),\n\t).Patch("/me", UpdateAccount)\n\n\tr, _ := http.NewRequest("PATCH", "/me", nil)\n\tr.Header.Set("x-myapp-access-token", "rainbow")\n\tr.Header.Set("X-Myapp-Client-Version", "284")\n\tr.Body = io.NopCloser(nil)\n\n\trw := httptest.NewRecorder()\n\trouter.ServeHTTP(rw, r)\n}\n'})})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'input: &main.UpdateAccountInput{AccessToken:"rainbow", ClientVersion:284}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"encoding",children:"Encoding"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"header"})," will encode the field value to the HTTP headers, the first key will be used, i.e. ",(0,i.jsx)(n.code,{children:"KEY1"}),", results in ",(0,i.jsx)(n.code,{children:"http.Request.Header.Set(KEY1, VALUE)"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"runable-example-1",children:"Runable Example"}),"\n",(0,i.jsx)(s.Z,{children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"fmt"\n\t"net/http/httputil"\n\n\t"github.com/ggicci/httpin"\n)\n\ntype UpdateAccountInput struct {\n\tAccessToken   string `in:"header=x-myapp-access-token"`\n\tClientVersion int    `in:"header=x-myapp-client-version"`\n}\n\nfunc main() {\n\tpayload := &UpdateAccountInput{\n\t\tAccessToken:   "rainbow",\n\t\tClientVersion: 813,\n\t}\n\tr, _ := httpin.NewRequest("PATCH", "/me", payload)\n\tdata, _ := httputil.DumpRequest(r, true)\n\tfmt.Printf("%s\\n", data)\n}\n'})})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"PATCH /me HTTP/1.1\nX-Myapp-Access-Token: rainbow\nX-Myapp-Client-Version: 813\n"})})]})}function x(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},4148:(e,n,t)=>{t.d(n,{Z:()=>s});var i=t(6112),r=(t(7294),t(5893));const s=e=>(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:e.inputTitle||"Input"}),(0,r.jsx)("th",{children:e.outputTitle||"Output"})]})}),(0,r.jsx)("tbody",{children:e.rows.map(((e,n)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)(i.Z,{children:e.input.trim()})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.Z,{className:"language-go",children:e.output.trim()})})]},n)))})]})}}]);
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[525],{2332:(e,t,n)=>{n.d(t,{Z:()=>d});var r=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(t){s(t)}}function o(e){try{u(r.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};class i{constructor(e="/goplay"){this.proxyUrl=e}raiseForStatus(e){return r(this,void 0,void 0,(function*(){if(!e.ok){const t=yield e.text();throw new Error(t?e.statusText+": "+t:e.statusText)}}))}compile(e,t){return r(this,void 0,void 0,(function*(){const n=new FormData;n.append("version","2"),n.append("withVet","true"),n.append("body",e);const r=yield fetch(`${this.proxyUrl}/_/compile?backend=${t||""}`,{method:"POST",body:n});return yield this.raiseForStatus(r),yield r.json()}))}renderCompile(e,t,n){return r(this,void 0,void 0,(function*(){e.replaceChildren(this.renderMessage("system","Waiting for remote server..."));const r=yield this.compile(t,n);if(e.replaceChildren(),""!=r.Errors)return e.appendChild(this.renderMessage("error",r.Errors)),void e.appendChild(this.renderMessage("system","\nGo build failed."));for(const t of r.Events||[])e.appendChild(yield this.renderEvent(t));e.appendChild(this.renderMessage("system","\nProgram exited."))}))}renderEvent(e){return r(this,void 0,void 0,(function*(){var t;return e.Delay>=0&&(yield(t=e.Delay/1e6,new Promise((e=>setTimeout(e,t))))),this.renderMessage(e.Kind,e.Message)}))}renderMessage(e,t){const n=document.createElement("span");return n.classList.add(e),n.innerText=t,n}share(e,t){return r(this,void 0,void 0,(function*(){const n=yield fetch(`${this.proxyUrl}/_/share`,{method:"POST",body:e});yield this.raiseForStatus(n);const r="https://go.dev/play/p/"+(yield n.text());return t?`${r}?v=${t}`:r}))}}var s=n(4464),a=n(7294);const o="toolbar_uIxz",u="button_yMrS",l="hidden_X41c",p="https://goplay.ggicci.me",c=e=>{const{children:t,onClick:n}=e;return a.createElement("button",{className:u,onClick:n},t)},d=e=>{const{children:t}=e,n=a.useRef(null),r=a.useRef(null),u=t&&t.props&&"pre"===t.props.mdxType&&t,d=u&&u.props&&u.props.children;if(!d||"code"!==d.props.mdxType)return a.createElement("div",null,"GoPlay: the wrapped data is not a codeblock.");if(!/\blanguage-go\b/.test(d&&d.props.className))return a.createElement("div",null,"GoPlay: only go code supported.");return a.createElement(a.Fragment,null,t,a.createElement("div",{ref:n,className:l},a.createElement(s.Z,{language:"text"},a.createElement("div",{ref:r}))),a.createElement("div",{className:o},a.createElement(c,{onClick:function(){if(r.current){const e=new i(p);n.current.classList.remove(l),e.renderCompile(r.current,d.props.children.trim())}}},"Run"),a.createElement(c,{onClick:async function(){const e=new i(p),t=await e.share(d.props.children.trim());window.open(t,"_blank")}},"Try it yourself \u21e2")))}},4148:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(4464),i=n(7294);const s=e=>i.createElement("table",null,i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",null,e.inputTitle||"Input"),i.createElement("th",null,e.outputTitle||"Output"))),i.createElement("tbody",null,e.rows.map(((e,t)=>i.createElement("tr",{key:t},i.createElement("td",null,i.createElement(r.Z,null,e.input.trim())),i.createElement("td",null,i.createElement(r.Z,{className:"language-go"},e.output.trim())))))))},6791:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>u,metadata:()=>p,toc:()=>d});var r=n(7462),i=(n(7294),n(3905)),s=n(2332),a=n(4148);const o={inputOutput:{inputTitle:"Request (URL query)",outputTitle:"ListUsersInput",rows:[{input:"\nGET /users?is_member=1&age_range[]=3&age_range[]=5\n",output:"\n{\n    IsMember: true,\n    AgeRange: []int{3, 5},\n}"},{input:"\nGET /users?age_range=3&age_range=5\n",output:"\n{\n    IsMember: false,\n    AgeRange: []int{3, 5},\n}"},{input:"\nGET /users?is_member=true\n",output:"\n{\n    IsMember: true,\n    AgeRange: []int{},\n}\n"}]}},u={sidebar_position:1},l="query",p={unversionedId:"directives/query",id:"directives/query",title:"query",description:"query is a directive executor who decodes a field from URL querystring parameters, i.e. http.Request.URL.Query().",source:"@site/docs/directives/query.mdx",sourceDirName:"directives",slug:"/directives/query",permalink:"/httpin/directives/query",draft:!1,editUrl:"https://github.com/ggicci/httpin/edit/documentation/docs/docs/directives/query.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"docsSidebar",previous:{title:"Getting Started",permalink:"/httpin/"},next:{title:"header",permalink:"/httpin/directives/header"}},c={},d=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Run Demo",id:"run-demo",level:2}],m={toc:d},h="wrapper";function g(e){let{components:t,...n}=e;return(0,i.kt)(h,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"query"},"query"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"query")," is a ",(0,i.kt)("a",{parentName:"p",href:"/advanced/concepts#directive-executor"},"directive executor")," who decodes a field from URL querystring parameters, i.e. ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/net/url#URL.Query"},(0,i.kt)("inlineCode",{parentName:"a"},"http.Request.URL.Query()")),"."),(0,i.kt)("h2",{id:"definition"},"Definition"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'Name: "query"\nArgs: KEY1 [,KEY2 [,KEY3, ...]]\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"query")," will examine values of the keys one by one (KEY1 -> KEY2 -> ...) from the URL query, the ",(0,i.kt)("strong",{parentName:"p"},"first non-empty")," value will be used to set the corresponding field of the input struct."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'type ListUsersInput struct {\n    IsMember bool  `in:"query=is_member"`\n    AgeRange []int `in:"query=age_range[],age_range"`\n}\n')),(0,i.kt)(a.Z,{inputTitle:o.inputOutput.inputTitle,outputTitle:o.inputOutput.outputTitle,rows:o.inputOutput.rows,mdxType:"InputOutputTable"}),(0,i.kt)("h2",{id:"run-demo"},"Run Demo"),(0,i.kt)(s.Z,{mdxType:"GoPlay"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "net/http"\n    "net/http/httptest"\n\n    "github.com/ggicci/httpin"\n    "github.com/go-chi/chi/v5"\n)\n\ntype ListUsersInput struct {\n    IsMember bool  `in:"query=is_member"`\n    AgeRange []int `in:"query=age_range[],age_range"`\n}\n\nfunc ListUsers(rw http.ResponseWriter, r *http.Request) {\n    input := r.Context().Value(httpin.Input).(*ListUsersInput)\n    fmt.Printf("input: %#v\\n", input)\n}\n\nfunc main() {\n    router := chi.NewRouter()\n    router.With(\n        httpin.NewInput(ListUsersInput{}),\n    ).Get("/users", ListUsers)\n\n    r, _ := http.NewRequest("GET", "/users?is_member=1&age_range=18&age_range=60", nil)\n\n    rw := httptest.NewRecorder()\n    router.ServeHTTP(rw, r)\n}\n'))))}g.isMDXComponent=!0}}]);
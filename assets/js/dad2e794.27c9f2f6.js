"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[937],{9961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const o={sidebar_position:4},l="Patch Field",d={unversionedId:"advanced/patch",id:"advanced/patch",title:"Patch Field",description:"Introduced in v0.12.0.",source:"@site/docs/advanced/patch.md",sourceDirName:"advanced",slug:"/advanced/patch",permalink:"/httpin/advanced/patch",draft:!1,editUrl:"https://github.com/ggicci/httpin/edit/documentation/docs/docs/advanced/patch.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"docsSidebar",previous:{title:"Upload Files",permalink:"/httpin/advanced/upload-files"}},r={},s=[{value:"JSON Payload Request",id:"json-payload-request",level:2},{value:"Form Request",id:"form-request",level:2}],p={toc:s},c="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"patch-field"},"Patch Field"),(0,i.kt)("p",null,"Introduced in v0.12.0."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/ggicci/httpin/patch"\n')),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/ggicci/httpin/patch#Field"},(0,i.kt)("inlineCode",{parentName:"a"},"patch.Field"))," is a generic struct:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"type Field[T any] struct {\n    Value T\n    Valid bool\n}\n")),(0,i.kt)("p",null,"It takes in a type parameter as the type of the actual value it holds, and wraps in a ",(0,i.kt)("inlineCode",{parentName:"p"},"Valid")," field as a sentinel, which is used to ",(0,i.kt)("strong",{parentName:"p"},'tell "the field is missing" from "the field is empty"'),"."),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"patch.Field[T]")," as the type of a field."),(0,i.kt)("h2",{id:"json-payload-request"},"JSON Payload Request"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/ggicci/httpin/patch"\n\ntype AccountPatchPayload struct {\n    Username patch.Field[string]\n    Gender   patch.Field[string]\n    Age      patch.Field[int]\n}\n\nfunc PatchAccount(rw http.ResponseWriter, r *http.Request) {\n    var payload AccountPatchPayload\n    json.NewDecoder(r.Body).Decode(&payload)\n\n    if !payload.Username.Valid {\n        // field "Username" is missing (not found or null)\n    }\n}\n')),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"In this package, and in a JSON object, a field is defined as a missing field when:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"if the name/key of the field is not found in the JSON object"),(0,i.kt)("li",{parentName:"ul"},"or the name/key of the field is present but its value is null, null is interpreted as having no value"))),(0,i.kt)("p",null,"For example, in the following two JSON objects, field Name is missing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{ "Age": 18 }\n{ "Name": null, "Age": 18 }\n')),(0,i.kt)("h2",{id:"form-request"},"Form Request"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/ggicci/httpin/patch"\n\ntype AccountPatchForm struct {\n    Username patch.Field[string] `in:"form=username"`\n    Gender   patch.Field[string] `in:"form=gender"`\n    Age      patch.Field[int]    `in:"form=age"`\n}\n\nfunc PatchAccount(rw http.ResponseWriter, r *http.Request) {\n    payload := r.Context().Value(httpin.Input).(*AccountPatchForm)\n\n    if !payload.Username.Valid {\n        // field "Username" is missing (not found or null)\n    }\n}\n')),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"In this package, in a querystring, form or multipart-form request, a field is defined as a missing field when:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"the name/key of the field doesn't appear in the request"))),(0,i.kt)("p",null,"For example, in the following request, ",(0,i.kt)("inlineCode",{parentName:"p"},"gender")," field is empty but not missing (i.e. ",(0,i.kt)("inlineCode",{parentName:"p"},"Gender.Valid == true"),"), while ",(0,i.kt)("inlineCode",{parentName:"p"},"age")," field is missing (i.e. ",(0,i.kt)("inlineCode",{parentName:"p"},"Age.Valid == false"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"GET /tasks?username=ggicci&gender=\n")))}u.isMDXComponent=!0}}]);
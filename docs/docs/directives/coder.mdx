---
sidebar_position: 99
---

import GoPlay from "../../src/components/GoPlay"
import InputOutputTable from "../../src/components/InputOutputTable"
import data from "./data/default"

# coder

Introduced in v0.15.0. For backward compatibility, `decoder` (introduced in v0.10.0) now is an alias of `coder`.

**coder** is a **SPECIAL** [directive executor](/advanced/concepts#directive-executor)
who overrides the coder that used to encode/decode the value of the corresponding field.

## Signature

```yaml
Name: "coder" | "decoder"
Args: CODER_NAME
```

When there's a _coder_ directive defined for a field, the specified named decoder will be used rather than
the default one which is auto-selected by the type of the field.

### Usage

```go {20,21,22,29}
import httpin_core "github.com/ggicci/httpin/core"

type MyDate time.Time // adapted time.Time to MyDate, MyDate must implement httpin_core.Stringable

func (t MyDate) ToString() (string, error) {
	return time.Time(t).Format("2006-01-02"), nil
}

func (t *MyDate) FromString(value string) error {
	v, err := time.Parse("2006-01-02", value)
	if err != nil {
		return &InvalidDate{Value: value, Err: err}
	}
	*t = MyDate(v)
	return nil
}

func init() {
	// Before using the named coder, you need to register it.
	httpin_core.RegisterNamedCoder[time.Time]("date", func(t *time.Time) (httpin_core.Stringable, error) {
		return (*MyDate)(t), nil
	})
}

type ListUsersInput struct {
	Gender string `in:"form=gender"`
	// By default, the decoder is auto-selected by the field type, which is of `time.Time`.
	// When coder directive is set, the specified named coder "date" will be used instead.
	Birthday time.Time `in:"form=birthday;coder=date"`
}
```

### Runable Example

<GoPlay>

```go
package main

import (
	"fmt"
	"net/http"
	"net/http/httptest"
	"time"

	"github.com/ggicci/httpin"
	"github.com/justinas/alice"
)

func init() {
	httpin.RegisterNamedDecoder("date", httpin.ValueTypeDecoderFunc(decodeDate))
}

func decodeDate(value string) (interface{}, error) {
	return time.Parse("2006-01-02", value)
}

type ListUsersInput struct {
	Gender string `in:"form=gender"`
	// By default, the decoder is auto-selected by the field type, which is of `time.Time`.
	// When decoder directive is set, the specified named decoder "date" will be used instead.
	Birthday time.Time `in:"form=birthday;decoder=date"`
}

func ListUsers(rw http.ResponseWriter, r *http.Request) {
	input := r.Context().Value(httpin.Input).(*ListUsersInput)
	fmt.Printf("input: %#v\n", input)
}

func main() {
	mux := http.NewServeMux()
	mux.Handle("/users", alice.New(
		httpin.NewInput(ListUsersInput{}),
	).ThenFunc(ListUsers))

	r, _ := http.NewRequest("GET", "/users?gender=male&birthday=1991-11-10", nil)
	rw := httptest.NewRecorder()
	mux.ServeHTTP(rw, r)
}
```

</GoPlay>

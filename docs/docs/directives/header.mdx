---
sidebar_position: 2
---

import GoPlay from "../../src/components/GoPlay"
import InputOutputTable from "../../src/components/InputOutputTable"
import data from "./data/header"

# header

**header** is a [directive executor](/advanced/concepts#directive-executor) who decodes/encodes a field from/to HTTP headers, i.e. [`http.Request.Header`](https://pkg.go.dev/net/http#Header).


## Signature

```yaml
Name: "header"
Args: KEY1 [,KEY2 [,KEY3, ...]]
```

## Decoding

**header** will examine values of the keys one by one (KEY1 -> KEY2 -> ...) from the HTTP headers, the **first non-empty** value will be used to set the corresponding field of the input struct.

:::caution

The keys will be normalized, see [`CanonicalHeaderKey`](https://pkg.go.dev/net/http#CanonicalHeaderKey), e.g. the header key of `Content-Type` and `content-type` are the same, which works like case-insensitive.

:::

### Usage

```go
type TokenInput struct {
	Token string `in:"header=x-api-token,Authorization"`
}
```

<InputOutputTable
  inputTitle={data.inputOutput.inputTitle}
  outputTitle={data.inputOutput.outputTitle}
  rows={data.inputOutput.rows}
></InputOutputTable>

### Runable Example

<GoPlay>

```go
package main

import (
	"fmt"
	"io"
	"net/http"
	"net/http/httptest"
	"net/url"
	"strings"

	"github.com/ggicci/httpin"
	"github.com/go-chi/chi/v5"
)

type UpdateAccountInput struct {
	AccessToken string `in:"header=x-myapp-access-token"`
	Bio         string `in:"form=bio"`
}

func UpdateAccount(rw http.ResponseWriter, r *http.Request) {
	input := r.Context().Value(httpin.Input).(*UpdateAccountInput)
	fmt.Printf("input: %#v\n", input)
}

func main() {
	router := chi.NewRouter()
	router.With(
		httpin.NewInput(UpdateAccountInput{}),
	).Patch("/me", UpdateAccount)

	r, _ := http.NewRequest("PATCH", "/me", nil)
	r.Header.Set("x-myapp-access-token", "rainbow")
	r.Header.Set("Content-Type", "application/x-www-form-urlencoded")
	form := make(url.Values)
	form.Add("bio", "ありがどう")
	r.Body = io.NopCloser(strings.NewReader(form.Encode()))

	rw := httptest.NewRecorder()
	router.ServeHTTP(rw, r)
}
```

</GoPlay>


Output:

```text
input: &main.UpdateAccountInput{AccessToken:"rainbow", Bio:"ありがどう"}
```

## Encoding

**header** will encode the field value to the HTTP headers, the first key will be used, i.e. `KEY1`, results in `http.Request.Header.Set(KEY1, VALUE)`.


### Runable Example

<GoPlay>

```go
package main

import (
	"fmt"
	"net/http/httputil"

	"github.com/ggicci/httpin"
)

type UpdateAccountInput struct {
	AccessToken   string `in:"header=x-myapp-access-token"`
	ClientVersion int    `in:"header=x-myapp-client-version"`
}

func main() {
	payload := &UpdateAccountInput{
		AccessToken:   "rainbow",
		ClientVersion: 813,
	}
	r, _ := httpin.NewRequest("PATCH", "/me", payload)
	data, _ := httputil.DumpRequest(r, true)
	fmt.Printf("%s\n", data)
}
```

</GoPlay>

Output:

```text
PATCH /me HTTP/1.1
X-Myapp-Access-Token: rainbow
X-Myapp-Client-Version: 813
```